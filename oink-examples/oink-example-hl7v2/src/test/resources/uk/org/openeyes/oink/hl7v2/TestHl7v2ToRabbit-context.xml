<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ctx="http://www.springframework.org/schema/context"
	xmlns:oink="http://www.openeyes.org.uk/schema/oink" xmlns:camel="http://camel.apache.org/schema/spring"
	xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd  
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
       http://www.openeyes.org.uk/schema/oink http://www.openeyes.org.uk/schema/oink/oink-1.0.xsd">

	<bean id="bridgePropertyPlaceholder"
		class="org.apache.camel.spring.spi.BridgePropertyPlaceholderConfigurer">
		<property name="location" value="classpath:hl7v2-test.properties" />
	</bean>

	<bean id="hl7codec" class="org.apache.camel.component.hl7.HL7MLLPCodec">
		<property name="charset" value="UTF-8" />
	</bean>

	<bean id="hl7dataformat" class="org.apache.camel.component.hl7.HL7DataFormat" />

	<bean id="ack" class="org.apache.camel.component.hl7.AckExpression" />

	<camelContext xmlns="http://camel.apache.org/schema/spring">

		<route>
			<from
				uri="mina2:tcp://{{hl7v2.host}}:{{hl7v2.port}}?sync=false&amp;codec=#hl7codec" />
			<convertBodyTo type="String" />
			<setHeader headerName="rabbitmq.ROUTING_KEY">
				<constant>{{rabbit.routingKey}}</constant>
			</setHeader>
			<log message="${headers}" />
			<log message="${body}" />
			<to
				uri="rabbitmq://{{rabbit.host}}:{{rabbit.port}}/{{rabbit.defaultExchange}}?vhost={{rabbit.vhost}}&amp;username={{rabbit.username}}&amp;password={{rabbit.password}}" />
			<transform>
				<ref>ack</ref>
			</transform>
		</route>


	</camelContext>

</beans>